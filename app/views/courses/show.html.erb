<h1>This is course show page</h1>

<h1><%= @course.title %></h1>

<p><%= @course.description %></p>

<% if current_user.enrolled_courses.include?(@course) && current_user.student? %>
  <% completed_lessons_count = 0 %>
  <% total_lessons_count = @course.lessons.count %>

  <% @course.lessons.each do |lesson| %>
    <% if CompletedLesson.exists?(user_id: current_user.id, lesson_id: lesson.id, completed: true) %>
      <% completed_lessons_count +=1 %>
    <% end %>
  <% end %>  

  <% if completed_lessons_count == total_lessons_count %>
    <h1>This course is completed</h1>
  <% elsif completed_lessons_count == 0 %>
    <h1>This course is not started yet</h1>
  <% else @complted < @total_lessons %>
    <h1>This course is in progress</h1>
  <% end %>  
  <h1><%= completed_lessons_count %> out of <%= total_lessons_count %> lessons completed</h1>
<% end %>

<% if current_user.enrolled_courses.include?(@course) || current_user.courses.include?(@course) %>
  <%= link_to 'View Lessons', course_lessons_path(@course) %><br>
  <%= link_to 'UnEnroll', course_enrollment_path(@course.id), data: { turbo_method: :delete } if current_user.student? %><br>
<% else %>
  <%= link_to 'Enroll', course_enrollments_path(@course.id),  data: { turbo_method: :post } %><br>
<% end %>

<% if current_user.instructor? %>
  <%= link_to 'Add lessons', new_course_lesson_path(course_id: @course.id) %>
<% end %>
<br>
<% if current_user.student? %>
  <%= link_to 'All courses', courses_path%><br>
  <%= link_to 'My learning', courses_path(clicked_my_learning: 'my_learning') %><br>
<% end %>

<% if current_user.instructor? %>
  <%= link_to 'Back to my courses', courses_path%><br>
<% end %>
